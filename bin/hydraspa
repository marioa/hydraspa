#!/usr/bin/env python
from __future__ import print_function

from docopt import docopt

import hydraspa as hrsp
from hydraspa.util import conv_to_number


def do_gather(d):
    out = hrsp.gather.gather(d)
    for k, v in out.items():
        print("{}: {}".format(k, v.mean()))


if __name__ == '__main__':
    args = docopt(hrsp.cli.__doc__)

    if args['list']:
        # must be one of structures, gases or forcefields
        if args['structures']:
            for k in sorted(hrsp.files.structures):
                print(k)
        elif args['gases']:
            for k in sorted(hrsp.files.gases):
                print(k)
        elif args['forcefields']:
            for k in sorted(hrsp.files.forcefields):
                print(k)
    elif args['create']:
        hrsp.cli_create(
            structure=args['-s'],
            gas=args['-g'],
            forcefield=args['-f'],
            outdir=args['-o'],
        )
    elif args['split']:
        pressures = [conv_to_number(v, float)
                     for v in args['-P'].split(',')]
        temperatures = [conv_to_number(v, float)
                        for v in args['-T'].split(',')]

        if args['-n']:
            cycles = conv_to_number(args['-c'], int)
        else:
            cycles = None

        fingerprint = hrsp.passport.create_passport(args['<dirname>'])
        hrsp.split(
            src=args['<dirname>'],
            fingerprint=fingerprint,
            ntasks=int(args['-n']),
            ncycles=cycles,
            pressures=pressures,
            temperatures=temperatures,
        )
    elif args['check']:
        hrsp.check(args['<dirname>'])
    elif args['gather']:
        do_gather(args['<dirname>'])
    elif args['--version']:
        print(hrsp.__version__)
